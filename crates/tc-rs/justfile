fork_url := env_var("RPC_URL_SEPOLIA")
# Forking from a slightly historic block so we can perform less work syncing
# when testing.
fork_block := "8800000"

test: 
    cargo test

integration-sync:
    #!/usr/bin/env bash
    set -euo pipefail

    # Start anvil in background
    anvil --fork-url {{fork_url}} --fork-block-number {{fork_block}} --port 8545 &
    ANVIL_PID=$!
    trap "kill $ANVIL_PID" EXIT

    # Wait for anvil to be ready
    sleep 2

    RUST_LOG=info cargo test -- test_sync_indexer --ignored --nocapture

integration-sync-broadcaster:
    RUST_LOG=info cargo test -- test_sync_broadcaster --ignored --nocapture
